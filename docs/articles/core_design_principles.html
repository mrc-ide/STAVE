<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="STAVE">
<title>Core Design Principles • STAVE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Core Design Principles">
<meta property="og:description" content="STAVE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">STAVE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-how-it-works">How it works</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-how-it-works">
    <a class="dropdown-item" href="../articles/core_design_principles.html">Core Design Principles</a>
    <a class="dropdown-item" href="../articles/studies_table.html">The Studies Table</a>
    <a class="dropdown-item" href="../articles/surveys_table.html">The Surveys Table</a>
    <a class="dropdown-item" href="../articles/counts_table.html">The Counts Table</a>
    <a class="dropdown-item" href="../articles/encoding_data.html">How To Encode Genetic Data</a>
    <a class="dropdown-item" href="../articles/calculating_prevalence.html">Calculating prevalence</a>
    <a class="dropdown-item" href="../articles/cautionary_notes.html">Cautionary Notes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/installation.html">Installation</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/reading_in_data.html">Reading in data and calculating prevalence</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mrc-ide/stave">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Core Design Principles</h1>
            
      
      
      <div class="d-none name"><code>core_design_principles.Rmd</code></div>
    </div>

    
    
<p>There are always trade-offs when deciding how to store data.
Different formats prioritise different things — human readability,
compact file size, speed of access, ease of sharing, etc. No single
approach optimises all of these at once. Where we choose to land depends
on the overall design philosophy and what we need the data to
support.</p>
<p>In the case of MMS, existing formats are not ideally suited to
estimating the prevalence of non-synonymous mutations or handling the
spatial–temporal complexity of metadata. Here we describe the specific
issues that STAVE is designed to address, which form the motivations
behind our design choices.</p>
<div class="section level3">
<h3 id="linkage-of-genetic-data-to-precise-space-time-coordinates">Linkage of genetic data to precise space-time coordinates<a class="anchor" aria-label="anchor" href="#linkage-of-genetic-data-to-precise-space-time-coordinates"></a>
</h3>
<p>Genetic data are often linked to places using descriptive fields like
the country name, an administrative area, or a “site” name. This is
flexible, but it brings a lot of ambiguity. A site might mean a clinic,
a village, a district, or something else entirely, and different
contributors rarely use the term in the same way. This makes it hard to
compare data across studies and can result in mixed levels of spatial
granularity within a single dataset.</p>
<p>Using free-text location names is also unreliable. Take Côte
d’Ivoire: it might appear as Ivory Coast, Cote d’Ivoire, Côte d’Ivoire,
Republic of Côte d’Ivoire, and many other variations that look almost
identical. These small differences can stop datasets from joining
cleanly, for example when grouping by country, and are a common source
of accidental data duplication.</p>
<p>Many projects try to avoid this by using country or administrative
codes such as ISO-2, ISO-3, or GADM IDs. This helps, but it introduces a
new problem: administrative boundaries and codes are not stable over
time. Countries split, rename, or merge; administrative units are
redrawn; and every coding system forces the data provider to choose one
particular version. This means the codes themselves can become a source
of inconsistency unless the chosen boundary set is carefully documented
and version-controlled.</p>
<p>Time information can be just as messy. Some datasets only record a
sampling year, which can mask interesting patterns in places with strong
seasonality. Others describe time in vague terms like “mid-2014” or
“rainy season”, which leaves too much room for interpretation.</p>
<p>STAVE takes a deliberately strict approach to these issues by
requiring precise spatial coordinates (latitude and longitude) and a
specific day of collection for every survey. Although this may seem
rigid, it simply reflects reality: <strong>each sampling event occurs at
a single place and time</strong> - the ambiguity comes from how data are
recorded, not from the sampling itself. By insisting on explicit spatial
and temporal anchors, <strong>STAVE makes a clean separation between
data recording and the administrative or interpretive layers that sit on
top of it</strong>. Country or administrative boundaries can always be
derived later by intersecting coordinates with a version-controlled
shapefile.</p>
<p>The main downside of this approach is that it sometimes requires
imputing spatial or temporal information when the original data are
vague or incomplete. STAVE accepts this trade-off: having precise
coordinates and dates resolves at least as many problems as imputation
introduces. To support this, STAVE includes free-text fields where users
can document how any spatial or temporal values were inferred. Even when
the imputation is coarse — for example, taking the midpoint of a
reported sampling range — it creates a transparent record of how
locations and dates were determined. This explicitness helps maintain
data provenance and motivates users to obtain the most accurate raw
information available.</p>
</div>
<div class="section level3">
<h3 id="flexible-encoding-of-haplotypes">Flexible encoding of haplotypes<a class="anchor" aria-label="anchor" href="#flexible-encoding-of-haplotypes"></a>
</h3>
<p>Existing approaches to encoding non-synonymous mutations, i.e. those
that change the amino acid code, each solve part of the problem but none
fully meet the needs of MMS. The de-facto shorthand — such as N86Y for
single codons or CVMNK for <em>pfcrt</em> haplotypes — is wonderfully
compact and easy to write, but provides no consistent rules for
representing mixed or phased calls, and different groups often improvise
their own conventions.</p>
<p>At the other extreme, formats like <a href="https://samtools.github.io/hts-specs/VCFv4.2.pdf" class="external-link">VCF</a> and
standards such as <a href="https://hgvs-nomenclature.org/stable/background/simple/" class="external-link">HGVS</a>
and <a href="https://www.ga4gh.org/product/variation-representation/" class="external-link">GA4GH
VRS</a> offer highly structured, rigorous ways to describe alleles,
haplotypes, and genotypes, including heterozygosity and phasing at the
DNA level. However, these are designed for individual-level,
nucleotide-resolved data and become either irrelevant (e.g. phasing
differences that collapse to the same amino acid) or extremely verbose
when applied to short haplotypes.</p>
<p>There is a clear gap for something in between: a lightweight,
human-readable encoding that is still rich enough to capture features
needed for prevalence estimation. This was the motivation behind
developing the <a href="https://github.com/mrc-ide/variantstring" class="external-link">variantstring</a>
format: a compact, human-readable way to encode amino-acid variation
that sits between informal shorthand like CVMNK and heavyweight
standards like HGVS or VRS.</p>
<p>For example, a simple <em>pfcrt</em> haplotype can be written as</p>
<pre><code><span><span class="va">pfcrt</span><span class="op">:</span><span class="fl">72</span><span class="op">-</span><span class="fl">76</span><span class="op">:</span><span class="va">CVIET</span></span></code></pre>
<p>and an unphased mixture of the CVIET and CVMNK haplotypes can be
written as</p>
<pre><code><span><span class="va">pfcrt</span><span class="op">:</span><span class="fl">72</span><span class="op">-</span><span class="fl">76</span><span class="op">:</span><span class="va">C_V_I</span><span class="op">/</span><span class="va">M_E</span><span class="op">/</span><span class="va">N_T</span><span class="op">/</span><span class="va">K</span></span></code></pre>
<p>This is short enough to be manually entered if needed - for example
when extracting data from academic publications.</p>
<p>When thinking about aggregated count data, each variantstring can be
paired with a numerator (the number of samples in which that variant
appears) and a denominator (the number of samples successfully sequenced
at the relevant loci). Once encoded in this way, STAVE can compute the
prevalence of any subset of a haplotype — for example, just codon 76 of
<em>pfcrt</em>, or codons 72–75 excluding 76 — by checking which samples
have unambiguous information over exactly those positions. For example,
in the unphased mixture shown above, we cannot assert the presence of
the CVIET haplotype itself, but we can say that codon 74 contains both
the <code>I</code> and <code>M</code> alleles.</p>
</div>
<div class="section level3">
<h3 id="relational-structure">Relational structure<a class="anchor" aria-label="anchor" href="#relational-structure"></a>
</h3>
<p>Aggregated genetic data rarely live comfortably in a single flat
table. Instead, they involve several distinct layers: study-level
context (who generated the data and why), survey-level context (where
and when samples were collected), and the genetic measurements
themselves. If these layers are mixed together it leads to redundant
information being entered multiple times, which bloats file sizes and
creates opportunities for data entry mistakes. A simple relational
structure helps avoid these problems by separating concerns:
<strong>each kind of information is stored once, in the place where it
naturally belongs, and other tables link back to it.</strong></p>
<p>STAVE uses a three-table relational layout built around this idea:
studies, surveys, and counts.</p>
<ul>
<li>
<strong>The studies table</strong> holds a stable identifier (the
<code>study_id</code>), a short label, a reference (e.g. DOI, URL, or
internal code), access level, and any additional notes or description.
These entries describe logical datasets or analyses rather than claiming
a one-to-one mapping with publications. In particular, several studies
may share the same publication or project, and some may represent
internal or unpublished work. The key point is that every survey and
every set of counts can be traced back to a study identifier that
summarises “what dataset this belongs to”.</li>
<li>
<strong>The surveys table</strong> represents the unit of sampling
in space and time. A survey is defined as a single sampling event (or
tightly bounded collection period) at a specific location. In STAVE,
this is anchored by latitude, longitude, and a collection day, with
optional start/end dates and free-text notes for any spatial or temporal
imputation. Each survey links to exactly one study via
<code>study_id</code>.</li>
<li>
<strong>The counts table</strong> stores the genetic measurements,
linking each observed variant to exactly one survey via
<code>survey_id</code>. Each row contains a <code>survey_id</code>, a
<em>variantstring</em> of the observed haplotype, and the associated
numerator and denominator. This is where the aggregated information
about non-synonymous mutations lives, but always in the context of a
specific survey and study.</li>
</ul>
<hr>
<p>The <a href="articles/studies_table.html">next few pages</a> go into
the specific formatting requirements of each of these three linked
tables. If you prefer to get stuck into code, the <a href="articles/reading_in_data.html">tutorials</a> use an example
dataset that is pre-loaded with the package to demonstrate core
functionalities.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bob Verity.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
