---
title: "The Surveys Table"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{The Surveys Table}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=FALSE}
library(STAVE)
if (requireNamespace("kableExtra", quietly = TRUE)) {
    library(kableExtra)
}
```

This table captures information about the context within which data were collected. We can think of a survey as **a single sampling event (or tightly bounded collection period) at a specific location**. Different surveys may occupy different spatial locations, different sampling times, or both.

An example of a correctly formatted *Surveys* table is given below (scroll too see the whole table):

```{r, echo=FALSE}
example_input$surveys |>
  kbl(format = "html", table.attr = "style='width:100%; white-space: nowrap;'") |>
  kable_styling(bootstrap_options = c("hover", "condensed"), 
                full_width = TRUE) |>
  scroll_box(width = "100%", height = NULL)
```

<br>

<a href="https://raw.githubusercontent.com/mrc-ide/STAVE/main/inst/extdata/vignettes/surveys_example.csv" 
   class="btn" 
   style="
     display:inline-block;
     padding:8px 14px;
     background-color:#0366d6;
     color:white !important;
     border-radius:6px;
     text-decoration:none;
     font-weight:600;
     ">
  ⬇️ Download as CSV
</a>

---

## Fields and requirements

Mandatory fields are shown in blue.

```{r, echo=FALSE}

rbind.data.frame(list(Column = cell_spec("study_id", color = "white", background = "#0366d6"),
                      Type = "Character string. Must be a valid identifier.",
                      Notes = "The foreign key for this study, pointing back to the <i>Studies</i> table."),
                 list(Column = cell_spec("survey_id", color = "white", background = "#0366d6"),
                      Type = "Character string. Must be a valid identifier.",
                      Notes = "The private key for this survey. Must be completely unique - not just unique within a study"),
                 list(Column = "country_name",
                      Type = "Character string or `NA`",
                      Notes = "Useful for quickly identifying the country, although should not be used for analysis or when joining data (see <i>Core Design Principles</i>)"),
                  list(Column = "site_name",
                      Type = "Character string or `NA`",
                      Notes = "Useful for quickly identifying the site, although should not be used in analysis or when joining data (see <i>Core Design Principles</i>)"),
                 list(Column = cell_spec("latitude", color = "white", background = "#0366d6"),
                      Type = "Numeric<br>[-90, 90]",
                      Notes = "Spatial coordinates. If imputed then details of the imputation should be recorded in the `location_method` and/or `location_notes`."),
                 list(Column = cell_spec("longitude", color = "white", background = "#0366d6"),
                      Type = "Numeric<br>[-180, 180]",
                      Notes = "Spatial coordinates. If imputed then details of the imputation should be recorded in the `location_method` and/or `location_notes`."),
                 list(Column = "location_method",
                      Type = "Character string or `NA`",
                      Notes = "How the location was determined, e.g. 'exact coordinates of health facility', or 'imputated as the centroid of the province', etc."),
                 list(Column = "location_notes",
                      Type = "Character string or `NA`",
                      Notes = "Any other important notes pertaining to the location (free text)."),
                 list(Column = "collection_start",
                      Type = "Proper date or `NA`<br>(see `?as.Date`)",
                      Notes = "The first day of a sample collection period."),
                 list(Column = "collection_end",
                      Type = "Proper date or `NA`<br>(see `?as.Date`)",
                      Notes = "The last day of a sample collection period."),
                 list(Column = cell_spec("collection_day", color = "white", background = "#0366d6"),
                      Type = "Proper date<br>(see `?as.Date`)",
                      Notes = "The specific day of sample collection. If imputed then details of the imputation should be recorded in the `time_method` and/or `time_notes`."),
                  list(Column = "time_method",
                      Type = "Character string or `NA`",
                      Notes = "How the collection day was determined, e.g. 'exact date', or 'imputated as the midpoint of the collection range', etc.."),
                 list(Column = "time_notes",
                      Type = "Character string or `NA`",
                      Notes = "Any other important notes pertaining to the collection time (free text).")) |>
  kbl(dformat = "html", escape = FALSE) |>
  kable_styling(full_width = FALSE) |>
  column_spec(1, width = "100px", border_left = "1px solid #ccc", border_right = "1px solid #ccc") |>
  column_spec(2, width = "150px", border_right = "1px solid #ccc") |>
  column_spec(3, border_right = "1px solid #ccc")
```

---

The [next page](articles/counts_table.html) shows how to encode genetic data in the *Counts* table.
